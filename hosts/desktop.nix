# Do not modify this file!  It was generated by ‘nixos-generate-config’
# and may be overwritten by future invocations.  Please make changes
# to /etc/nixos/configuration.nix instead.
{ config, lib, pkgs, ... }:

{
  imports =
    [ <nixpkgs/nixos/modules/installer/scan/not-detected.nix>
    ];

  boot = {
    loader = {
      systemd-boot = {
        enable = true;
        configurationLimit = 20; # Only keep the last 20 generations.
        consoleMode = "keep";
        editor = false;
        memtest86.enable = true;
      };
    };

    initrd.availableKernelModules = [ "xhci_pci" "ahci" "usb_storage" "usbhid" "sd_mod" "sr_mod" ];
    initrd.kernelModules = [ ];
    kernelModules = [ "kvm-intel" ];
    extraModulePackages = [ ];
  };

  fileSystems."/" =
    { device = "/dev/disk/by-uuid/e9cfae6e-91e4-47dc-a018-4b111f13d8f3";
      fsType = "ext4";
    };

  fileSystems."/boot" =
    { device = "/dev/disk/by-uuid/B92A-E549";
      fsType = "vfat";
    };

  swapDevices =
    [ { device = "/dev/disk/by-uuid/fae28b9f-66b7-48f3-9217-1b3275894290"; }
    ];

  networking = {
    hostName = "Karl-Desktop";
    networkmanager.enable = true;
    # Interface-wide useDHCP will be deprecated, so per-interface useDHCP is used.
    useDHCP = false;
    interfaces = {
      enp0s31f6.useDHCP = true;
    };
  };

  services.xserver = {
    enable = true;
    videoDrivers = [ "nvidia" ]; # "nouveau" "nvidiaLegacy390" "intel" ];
#     config = lib.mkForce ''
# Section "ServerLayout"
#     Identifier     "Layout0"
#     Screen      0  "Screen0"
#     Screen      1  "Screen1" Rightof "Screen0"
#     Option         "Xinerama" "1"
# EndSection

# Section "Monitor"
#     # HorizSync source: edid, VertRefresh source: edid
#     Identifier     "Monitor0"
#     Option         "DPMS"
# EndSection

# Section "Monitor"
#     Identifier     "Monitor1"
#     Option         "DPMS"
# EndSection

# Section "Device"
#     Identifier     "Device0"
#     Driver         "nvidia"
#     VendorName     "NVIDIA Corporation"
#     BoardName      "GeForce GTX 1080"
#     BusID          "PCI:1:0:0"
# EndSection

# Section "Device"
#     Identifier     "Device1"
#     Driver         "nvidia"
#     VendorName     "NVIDIA Corporation"
#     BoardName      "GeForce GTX 980Ti"
#     BusID          "PCI:2:0:0"
# EndSection

# Section "Screen"
#     Identifier     "Screen0"
#     Device         "Device0"
#     Monitor        "Monitor0"
#     DefaultDepth    24
#     Option         "Stereo" "0"
#     Option         "nvidiaXineramaInfoOrder" "DFP-0"
#     # Option         "metamodes" "DVI-D-0: nvidia-auto-select +1920+0, HDMI-1: nvidia-auto-select +4480+0, HDMI-2: nvidia-auto-select +0+0"
#     Option         "SLI" "Off"
#     Option         "MultiGPU" "Off"
#     Option         "BaseMosaic" "off"
#     SubSection     "Display"
#         Depth       24
#     EndSubSection
# EndSection

# Section "Screen"
#     Identifier     "Screen1"
#     Device         "Device1"
#     Monitor        "Monitor1"
#     DefaultDepth    24
#     Option         "Stereo" "0"
#     Option         "nvidiaXineramaInfoOrder" "DFP-0"
#     # Option         "metamodes" "HDMI-1: nvidia-auto-select +4480+360, HDMI-2: nvidia-auto-select +0+360, DVI-D-0: nvidia-auto-select +1920+0"
#     Option         "SLI" "Off"
#     Option         "MultiGPU" "Off"
#     Option         "BaseMosaic" "off"
#     SubSection     "Display"
#         Depth       24
#     EndSubSection
# EndSection

# Section "Extensions"
#     Option "Composite" "Disable"
# EndSection
#     '';
#     config = lib.mkForce ''
# # Section "ServerFlags"
# #   Option "AllowMouseOpenFail" "on"
# #   Option "DontZap" "on"
# # EndSection

# # Section "Module"
# # EndSection

# # Section "Monitor"
# #   Identifier "Monitor[0]"
# #   Option "LeftOf" "Monitor[1]"
# # EndSection

# # Section "Monitor"
# #   Identifier "Monitor[1]"
# #   Option "RightOf" "Monitor[0]"
# # EndSection

# # # Additional "InputClass" sections
# # #
# # Section "ServerLayout"
# #   Identifier "Layout[all]"
# #   # Reference the Screen sections for each driver.  This will
# #   # cause the X server to try each in turn.
# #   Screen 0 "Screen-nvidia[0]"
# #   Screen 1 "Screen-nvidia[1]" RightOf "Screen-nvidia[0]"
# # EndSection

# # # For each supported driver, add a "Device" and "Screen"
# # # section.

# Section "Device"
#   Identifier "Device-nvidia[0]"
#   Driver "nvidia"
#   VendorName "NVIDIA Corporation"
#   BoardName "GeForce GTX 1080"
#   BusID "PCI:1:0:0"
#   # Option "Monitor-HDMI-0" "Monitor[0]"
#   # Screen 0
# EndSection

# Section "Device"
#   Identifier "Device-nvidia[1]"
#   Driver "nvidia"
#   VendorName "NVIDIA Corporation"
#   BoardName "GeForce GTX 980Ti"
#   BusID "PCI:2:0:0"
#   # Option "Monitor-DVI-I-1" "Monitor[1]"
#   # Screen 1
# EndSection

# # Section "Screen"
# #   Identifier "Screen-nvidia[0]"
# #   Device "Device-nvidia[0]"
# #   Monitor "Monitor[0]"
# #   Option "nvidiaXineramaInfoOrder" "DFP-1"
# #   Option "metamodes" "DFP: nvidia-auto-select +0+0"
# #   Option "MetaModeOrientation" "DFP-0 RightOf DFP-1"
# # EndSection

# # Section "Screen"
# #   Identifier "Screen-nvidia[1]"
# #   Device "Device-nvidia[1]"
# #   Monitor "Monitor[1]"
# #   Option "nvidiaXineramaInfoOrder" "DFP-1"
# #   Option "metamodes" "DFP-1: nvidia-auto-select +0+0"
# # EndSection
#     '';
    # defaultDepth = 24;
    # verbose = 7;
    # serverLayoutSection = ''
    #   Screen "Screen1" # RightOf "Screen-nvidia[0]"
    #   InputDevice "Mouse0" "CorePointer"
    #   InputDevice "Keyboard0" "CoreKeyboard"

    #   # Enable Xinerama to combine separate screens to a single one.
    #   Option "Xinerama" "On"
    # '';
    # monitorSection = ''
    #   # LG MP59HT Monitor
    #   VendorName      "Unknown"
    #   ModelName       "LG Electronics MP59HT"
    #   HorizSync       30.0 - 85.0
    #   VertRefresh     40.0 - 75.0
    #   Option          "DPMS"
    # '';
    # deviceSection = ''
    #   # GTX1080 Card
    #   VendorName      "NVIDIA Corporation"
    #   BoardName       "GeForce GTX 1080"
    #   BusID           "PCI:1:0:0"
    # '';
    # screenSection = ''
    #   DefaultDepth    24
    #   Option         "Stereo" "0"
    #   # Option         "nvidiaXineramaInfo" "True"
    #   # Option         "nvidiaXineramaInfoOrder" "DFP-0"
    #   Option         "metamodes" "nvidia-auto-select +0+0"
    #   Option         "SLI" "Off"
    #   Option         "MultiGPU" "Off"
    #   Option         "BaseMosaic" "Off"
    #   SubSection     "Display"
    #       Depth       24
    #   EndSubSection
    # '';
    # config = ''
    #   Section "InputDevice"
    #     Identifier    "Mouse0"
    #     Driver        "mouse"
    #     Option        "Protocol" "auto"
    #     Option        "Device" "/dev/input/mice"
    #     Option        "Emulate3Buttons" "no"
    #     Option        "ZAxisMapping" "4 5 6 7"
    #   EndSection

    #   Section "InputDevice"
    #     Identifier   "Keyboard0"
    #     Driver       "kbd"
    #   EndSection

    #   Section "Device"
    #     Identifier      "GTX980Ti"
    #     Driver          "nvidia"
    #     VendorName      "NVIDIA Corporation"
    #     BoardName       "GeForce GTX 980 Ti"
    #     BusID           "PCI:2:0:0"
    #   EndSection

    #   Section "Screen"
    #     Identifier     "Screen1"
    #     Device         "GTX980Ti"
    #     Monitor        "Monitor1"
    #     DefaultDepth   24
    #     # Option         "nvidiaXineramaInfo" "True"
    #     Option         "metamodes" "nvidia-auto-select +0+0 {AllowGSYNC=Off}"
    #     Option         "SLI" "Off"
    #     Option         "MultiGPU" "Off"
    #     Option         "BaseMosaic" "Off"
    #     SubSection     "Display"
    #         Depth       24
    #     EndSubSection
    #   EndSection

    #   Section "Monitor"
    #     Identifier      "Monitor1"
    #     VendorName      "HP"
    #     ModelName       "X20LED"
    #     HorizSync       0.0 - 0.0
    #     VertRefresh     0.0
    #     Option          "DPMS"
    #     Option          "RightOf" "Monitor[0]"
    #   EndSection
    # '';
    exportConfiguration = true; # Show xserver settings in xorg.conf file in /etc/X11/
  };

  hardware = {
    opengl.enable = true; # Enable OpenGL.
    # Update microcode. Address "Firmware Bug" startup messages.
    cpu.intel.updateMicrocode = true;
  };

  nix.maxJobs = lib.mkDefault 8;
  powerManagement.cpuFreqGovernor = lib.mkDefault "performance";
}
